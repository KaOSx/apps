
# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgname=kcp
pkgver=1.0.0
pkgrel=1
_commit=7789a39
pkgdesc="A command-line tool for KaOS Community Packages"
arch=('x86_64')
url="https://github.com/bvaudour/kcp"
license=('Public Domain')
install=kcp.install
depends=('git')
makedepends=('go')
source=("https://github.com/bvaudour/kcp/tarball/master/kcp-${pkgver}.tar.gz")
#source=("https://github.com/bvaudour/kcp/releases/download/${pkgver}/kcp-${pkgver}.tar.gz")
md5sums=('04d778d67ec04b59ff19456b0883b19a')
 
build() {
  cd bvaudour-${pkgname}-${_commit}
  
  mkdir -p build
  
  sed -i 's|-mod=vendor|mod=readonly|' Makefile.in
  
  #export GOPATH=${GOPATH}:"${srcdir}"
  #export GO111MODULE=on
  export GOFLAGS="-v -trimpath -modcacherw"
  #export LDFLAGS=''
  
  ./configure --version ${pkgver} --user ${_user} --password ${_password}
  make 
}

package() {
  cd bvaudour-${pkgname}-${_commit} 
  make DESTDIR=${pkgdir} install

  install -Dm644 LICENSE ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}
