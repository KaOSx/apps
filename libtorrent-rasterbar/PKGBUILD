
pkgname=libtorrent-rasterbar
pkgver=1.2.15
pkgrel=2
pkgdesc="A C++ library that aims to be a good alternative to all the other bittorrent implementations around"
url="https://libtorrent.org/"
arch=('x86_64')
license=('custom')
depends=('boost-libs' 'python3' 'geoip')
makedepends=('boost' 'cmake' 'python3-setuptools')
source=("https://github.com/arvidn/libtorrent/releases/download/v${pkgver}/${pkgname}-${pkgver}.tar.gz"
        "https://github.com/arvidn/libtorrent/pull/5738/commits/e904fd3f6664422db98b07177054f92edce62b0c.diff")
md5sums=('aa66c585e2744f839383d37bc15558d4'
         'a7845520dc69c5551df6923c121d6e50')

prepare() {
  cd ${pkgname}-${pkgver}
  # https://github.com/arvidn/libtorrent/pull/5738, boost 1.75 needed
  #patch -p1 -i ${srcdir}/e904fd3f6664422db98b07177054f92edce62b0c.diff
}

build() {
  cmake -B build -S ${pkgname}-${pkgver} \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -Dpython-bindings=ON \
    -DBoost_DEBUG=ON \
    -DBoost_NO_BOOST_CMAKE=ON
  cmake --build build
}

package() {

  DESTDIR=${pkgdir} cmake --install build
}

